@startuml

scale 1.2
title Game flowchart

(*) -->[set first player as current] if "In jail?" as turn_start then
		-->[yes] if "Want to pay $50 deposit?" then
			-->[yes] "<b>GTFO !</b>
						get out of jail" as jail_out
			--> "<b>Move</b>
						advance current player dy dice" as move
		else
			-->[no] if "Rolled a double?" then
				-->[yes] jail_out
			else
				-->[no] "<b>Finish turn</b>
									set next player as current" as finish_turn
			endif
		endif
	else
	-->[no] if "Want to trade?" then
	-->[yes] "<b>Make offer</b>
				set player being offered to as current"
	--> if "Accepts offer?" then
		-->[yes] "<b>Apply offer</b>
			transfer stuff
			set original current player back"
		--> move
		--> if "Passed GO?" then
			-->[yes] "<b>Collect $200 salary</b>"
			--> if "On property?" as on_property then
				-->[yes] if "Owned?" then
					-right->[no] if "Enough money?" then
						-up->[no] finish_turn
					else
						-right->[yes] if "Want to buy?" then
							-right->[yes] "<b>Buy property</b>
									substract property price from current player's money
									add property to current players's properties"
							-up-> finish_turn
						else
							-up->[no] finish_turn
						endif
					endif
				else
					-down->[yes] if "By Player ?" then
						-right->[yes] "It's all good, you're <b>home</b>
							Have a beer" as home
					else
						-down->[no] "<b>Calculate rent</b>"
						-down-> if "Enough money?" then
							-right->[yes] "<b>Cha-ching</b>
									make player pay the rent\nto owner"
							-up-> finish_turn
						else
							-down->[no] "<b>Bankruptcy</b>
								remove current player from game"
							-right-> if "At least 2 players left?" then
								-right->[no] (*)
							else
								-up->[yes] finish_turn
							endif
						endif
					endif		
					home -up-> finish_turn
				endif
			else
				-right->[no] finish_turn
				-up-> turn_start
			endif
		else
			-down->[no] on_property
		endif
	else
		-->[no] "<b>Reject offer</b>
			set original current player back"
		--> move
	endif
else
	-->[no] move
endif
endif

@enduml